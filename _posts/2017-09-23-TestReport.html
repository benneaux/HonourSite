<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Benjamin Moran" />


<title>Honours Meeting</title>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type="text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Honours Meeting</h1>
<h4 class="author"><em>Benjamin Moran</em></h4>
<h4 class="date"><em>5 May 2017</em></h4>

</div>


<pre class="r"><code>knitr::opts_chunk$set(eval = TRUE)
library(astsa)
library(knitr)
library(ggplot2)
library(tidyverse)
library(forecast)</code></pre>
<pre class="r"><code>fit &lt;- arima(Vaxx,c(3,0,0))
fit$coef</code></pre>
<pre><code>##        ar1        ar2        ar3  intercept
##  0.9305865  0.2281323 -0.3179756  0.0255746</code></pre>
<pre class="r"><code>pwUnVacc &lt;- stats::filter(UnVacc, filter = c(1,-fit$coef[1],-fit$coef[3]), sides = 1)
resVaxx &lt;- fit$residuals</code></pre>
<pre class="r"><code>Vaxx &lt;- ts(Vaxx,start = 1, end = 115)
zVaxx &lt;- ts.intersect(Vaxx, stats::lag(Vaxx, -1), stats::lag(Vaxx, -4))</code></pre>
<pre class="r"><code>plot(zVaxx)</code></pre>
<img src="{{site.url}}/_images/HonoursMeeting/unnamed-chunk-2-1.png" style="display: block; margin: auto;" />
<pre class="r"><code>fit2 &lt;- arima(UnVacc[5:115],c(2,0,0), xreg = cbind(zVaxx[,2],zVaxx[,3]))
fit2</code></pre>
<pre><code>##
## Call:
## arima(x = UnVacc[5:115], order = c(2, 0, 0), xreg = cbind(zVaxx[, 2], zVaxx[,
##     3]))
##
## Coefficients:
##          ar1      ar2  intercept  zVaxx[, 2]  zVaxx[, 3]
##       0.9559  -0.2062     0.0154      0.4691      0.1391
## s.e.  0.1524   0.1250     0.0052      0.1886      0.1315
##
## sigma^2 estimated as 1.438e-05:  log likelihood = 460.76,  aic = -909.52</code></pre>
<pre class="r"><code>UnVacc &lt;- ts(UnVacc, start = 1, end = 115)
zUnVacc &lt;-  ts.intersect(UnVacc, stats::lag(UnVacc, -1), stats::lag(UnVacc, -2))</code></pre>
<p>We can look at the plot.</p>
<pre class="r"><code>plot(zUnVacc)</code></pre>
<img src="{{site.url}}/_images/HonoursMeeting/unnamed-chunk-2-2.png"/>
<pre class="r"><code>fit3 &lt;- lm(zUnVacc[3:113,1] ~ zUnVacc[3:113,2] + zUnVacc[3:113,3] + zVaxx[,2] + 0)
summary(fit3)</code></pre>
<pre><code>##
## Call:
## lm(formula = zUnVacc[3:113, 1] ~ zUnVacc[3:113, 2] + zUnVacc[3:113,
##     3] + zVaxx[, 2] + 0)
##
## Residuals:
##        Min         1Q     Median         3Q        Max
## -0.0083887 -0.0022870  0.0001358  0.0027351  0.0102503
##
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)
## zUnVacc[3:113, 2]   0.8640     0.1073   8.054 1.15e-12 ***
## zUnVacc[3:113, 3]  -0.4184     0.0911  -4.593 1.19e-05 ***
## zVaxx[, 2]          0.6537     0.1337   4.889 3.55e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
##
## Residual standard error: 0.003785 on 108 degrees of freedom
## Multiple R-squared:  0.9867, Adjusted R-squared:  0.9863
## F-statistic:  2663 on 3 and 108 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>VaxxNew &lt;- ts(Vaxx[1:92], start = 1, end = 92)
UnVaccNew &lt;- ts(UnVacc[1:92], start = 1, end = 92)</code></pre>
<p>Use this model to predict 2016. Condider all from 2015; then all 2015 + first week of 2016.</p>
<div id="relative-error" class="section level4">
<h4>Relative error</h4>
<pre class="r"><code>n.samp &lt;- 23
end.ind &lt;- length(UnVacc) - n.samp
fit3 &lt;- lm(zUnVacc[3:end.ind,1] ~ zUnVacc[3:end.ind,2] + zUnVacc[3:end.ind,3] + zVaxx[3:end.ind,2])

predicted &lt;- tbl_df(predict(fit3, newdata = data.frame(x = n.samp), se.fit = TRUE))</code></pre>
<pre><code>## Warning: 'newdata' had 1 row but variables found have 90 rows</code></pre>
<pre class="r"><code>rel.error &lt;- abs(UnVacc[(end.ind + 1):115]-predicted$fit)/UnVacc[(end.ind + 1):115]</code></pre>
<pre><code>## Warning in UnVacc[(end.ind + 1):115] - predicted$fit: longer object length
## is not a multiple of shorter object length</code></pre>
<pre><code>## Warning in abs(UnVacc[(end.ind + 1):115] - predicted$fit)/UnVacc[(end.ind
## + : longer object length is not a multiple of shorter object length</code></pre>
<pre class="r"><code>rel.error2 &lt;- data.frame(data=cbind(UnVacc[(end.ind + 1):115], predicted$fit, rel.error))</code></pre>
<pre><code>## Warning in cbind(UnVacc[(end.ind + 1):115], predicted$fit, rel.error):
## number of rows of result is not a multiple of vector length (arg 1)</code></pre>
<pre class="r"><code>colnames(rel.error2) &lt;- c(&quot;Actual&quot;, &quot;Predicted&quot;, &quot;Relative error&quot;)
rel.error3 &lt;- rel.error2 %&gt;%
  mutate(ID = 1:n()) %&gt;%
  select(-`Relative error`) %&gt;%
  gather(key = series, value = values, `Actual`, `Predicted`,-ID)</code></pre>
<img src="{{site.url}}/_images/HonoursMeeting/relerror-1.png"/>
<pre class="r"><code>plot.ts(UnVacc[1:end.ind], ylim=c(0, 0.06), xlim=c(0,111)) + # Label title and axes
lines(c(1:111), as.numeric(predict(fit3,newdata = data.frame(x = n.samp)), col=&quot;red&quot;))
#lines(c((end.ind + 1):115), as.numeric(predict(fit3, n.samp)-2*predict(fit3, n.samp)$se), col=&quot;red&quot;, lty=&quot;dashed&quot;)
#lines(c((end.ind + 1):115), as.numeric(predict(fit.uv, n.samp)$pred+2*predict(fit.uv, n.samp)$se), col=&quot;red&quot;, lty=&quot;dashed&quot;)
#legend(&quot;topright&quot;, legend=c(&quot;Actual&quot;, &quot;Predicted (+/- 2SE)&quot;), lty=1, col=1:2, bty=&quot;n&quot;)
test &lt;- predict(fit3, new, interval = &quot;prediction&quot;)</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
